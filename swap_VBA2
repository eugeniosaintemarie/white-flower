#If VBA7 Then
    ' Para Excel de 64 bits
    Private Declare PtrSafe Function GetAsyncKeyState Lib "user32" (ByVal vKey As Long) As Integer
#Else
    ' Para Excel de 32 bits
    Private Declare Function GetAsyncKeyState Lib "user32" (ByVal vKey As Long) As Integer
#End If

Sub LoopConSalida()
    Dim i As Long
    
    ' Iniciar el loop
    For i = 1 To 100000
        ' Realiza alguna operación
        Cells(i, 1).Value = i
        
        ' Permite que Excel procese eventos
        DoEvents
        
        ' Detectar si se ha presionado la tecla 'Esc' (código ASCII: 27)
        If GetAsyncKeyState(27) <> 0 Then
            MsgBox "Loop cancelado por el usuario.", vbExclamation
            Exit For  ' Salir del bucle
        End If
    Next i
    
    MsgBox "Proceso terminado.", vbInformation
End Sub
